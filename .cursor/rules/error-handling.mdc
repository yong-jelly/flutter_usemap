---
description: "에러 처리 규칙 - 예외 처리 및 사용자 에러 메시지 가이드"
globs: ["lib/**/*.dart"]
alwaysApply: true
---

# 에러 처리 & 예외 규칙

## 공통

- 예외는 도메인/네트워크/플랫폼 레벨을 구분한다.
- Riverpod AsyncValue를 통해 UI에서 로딩/에러/데이터를 명확히 구분한다.

## 오류 타입

- core/network/api_exception.dart 등에 공통 에러 타입 정의:
  - NetworkException
  - ServerException
  - AuthException
  - ValidationException
  - UnknownException 등
- domain 레이어에서는 Failure/DomainException 등 의미 있는 타입으로 변환해서 사용한다.

## UI 처리

- AsyncValue.when / maybeWhen 을 사용해 다음 패턴을 표준으로 삼는다:
  - loading: 공통 로딩 위젯
  - error: 공통 에러 위젯 + 재시도 버튼(옵션)
  - data: 정상 렌더링
- 예외 발생 시 사용자가 이해할 수 있는 메시지를 노출하고, 개발용 로그는 별도 로깅으로 남긴다.

## 에러 변환 체인

- Data Layer: 네트워크/플랫폼 예외를 도메인 예외로 변환
- Domain Layer: 비즈니스 규칙 위반을 의미 있는 Failure로 표현
- Presentation Layer: Failure를 사용자 친화적 메시지로 변환

예시:
```dart
// Data Layer
try {
  final response = await dio.get('/api/user');
  return UserModel.fromJson(response.data);
} on DioException catch (e) {
  throw NetworkException.fromDioException(e);
}

// Domain Layer (UseCase)
try {
  return await repository.getUser(id);
} on NetworkException catch (e) {
  throw UserNotFoundFailure(e.message);
}

// Presentation Layer (Controller)
state = await AsyncValue.guard(() async {
  return await useCase.getUser(id);
});
```