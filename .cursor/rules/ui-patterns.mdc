---
description: "UI 레이어 패턴 - 위젯 구조 및 사용자 상호작용 처리 가이드"
globs: ["lib/features/**/presentation/**/*.dart"]
alwaysApply: true
---

# UI 레이어 패턴

## 위젯 구조 원칙

- 위젯은 가능한 한 작고 재사용 가능하게 작성한다.
- Stateless 위젯을 우선하고, 상태가 필요한 경우 Riverpod Provider를 사용한다.
- const 생성자를 적극 활용한다.

## 플랫폼 적응형 UI (최우선)

- **모든 UI 컴포넌트는 adaptive_platform_ui 패키지를 최우선으로 사용한다.**
- 기본 Flutter 위젯(Scaffold, AppBar, Button, TextField 등) 대신 adaptive_platform_ui의 Adaptive 위젯을 사용한다.
- 예시:
  ```dart
  // ❌ 나쁜 예
  Scaffold(
    appBar: AppBar(...),
    body: ...,
  )
  
  // ✅ 좋은 예
  AdaptiveScaffold(
    appBar: AdaptiveAppBar(...),
    body: ...,
  )
  
  // ❌ 나쁜 예
  ElevatedButton(...)
  TextField(...)
  
  // ✅ 좋은 예
  AdaptiveButton(...)
  AdaptiveTextField(...)
  ```
- 플랫폼별 자동 적응:
  - iOS 26+: 네이티브 UIKit 컴포넌트 (Liquid Glass 효과 포함)
  - iOS 18 이하: Cupertino 위젯
  - Android: Material Design 위젯
- 예외: adaptive_platform_ui에서 제공하지 않는 특수한 커스텀 UI만 직접 구현한다.

## 위젯 파일 구조

- Export 위젯(public API) → 하위 위젯 → 헬퍼 함수 → 정적 콘텐츠 → 타입 정의 순서로 배치
- 복잡한 위젯은 여러 파일로 분리한다.

## 사용자 상호작용 처리

- 사용자 액션(버튼 클릭, 폼 제출 등)은 Controller의 메서드로 위임한다.
- 위젯에서 직접 비즈니스 로직을 호출하지 않는다.

예시:
```dart
// ❌ 나쁜 예
ElevatedButton(
  onPressed: () async {
    final result = await useCase.login(email, password);
    // ...
  },
)

// ✅ 좋은 예
ElevatedButton(
  onPressed: () => ref.read(loginControllerProvider.notifier).submit(email, password),
)
```

## 로딩/에러 상태 표시

- AsyncValue.when을 사용하여 상태별 UI를 명확히 구분한다.
- 공통 로딩/에러 위젯은 core/ui/widgets에 정의한다.

예시:
```dart
ref.watch(loginControllerProvider).when(
  data: (user) => HomePage(user: user),
  loading: () => const LoadingWidget(),
  error: (error, stack) => ErrorWidget(error: error, onRetry: () => ...),
)
```

## 폼 처리

- 폼 상태는 Controller 내부의 State 클래스로 관리한다.
- 또는 별도의 Notifier를 만들어 폼 상태만 관리할 수 있다.
- 유효성 검사는 domain 레이어의 Value Object나 UseCase에서 처리한다.

## 리스트/페이지네이션

- 무한 스크롤은 AsyncNotifier의 build 메서드에서 페이지를 관리한다.
- 새 데이터 로드는 별도 메서드(fetchMore 등)로 처리한다.
- 로딩 상태는 AsyncValue에 포함되거나 별도 플래그로 관리한다.